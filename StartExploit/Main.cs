using System;
using metasploitsharp;
using System.Collections.Generic;

namespace StartExploit
{
	class MainClass
	{
		public static void Main (string[] args)
		{
			using (MetasploitSession session = new MetasploitSession("metasploit", "2c8X|a2!", "https://192.168.1.148:3790/api/1.1"))
			{
				using (MetasploitProManager manager = new MetasploitProManager(session))
				{
//						{
//						"workspace" => "Project1",
//						"DS_WHITELIST_HOSTS" => "192.168.0.0/24",
//						"DS_MinimumRank" => "great",
//						"DS_EXPLOIT_SPEED" => 5,
//						"DS_EXPLOIT_TIMEOUT" => 2,
//						"DS_LimitSessions" => true,
//						"DS_MATCH_VULNS" => true,
//						"DS_MATCH_PORTS" => true
//						}

					Dictionary<string, object> options = new Dictionary<string, object>();				
					options.Add("workspace", "default");
					options.Add("DS_WHITELIST", "192.168.1.0/24");
					options.Add("DS_MinimumRank", "great");
					options.Add("DS_EXPLOIT_SPEED", 5);
					options.Add("DS_EXPLOIT_TIMEOUT", 2);
					options.Add("DS_LimitSessions", true);
					options.Add("DS_MATCH_VULNS", true);
					options.Add("DS_MATCH_PORTS", true);
					
					Dictionary<string, object> response = manager.StartExploit(options);
					
					foreach (var pair in response)
						Console.WriteLine(pair.Key + ": " + pair.Value);
				}
			}
		}
	}
}
